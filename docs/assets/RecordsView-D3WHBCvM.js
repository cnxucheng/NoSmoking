import{d as j,r as f,q as v,R as r,x as V,o as q,b as y,f as t,c as n,w,g as m,h as P,j as D,F as L,k as G,l as J,y as Q,z as Y,t as d,A as W,B as X,C as E,p as $,v as _,_ as Z}from "./index-CK-ih7MW.js";const ee={class:"records"},te={class:"page-header"},se={class:"filter-controls"},ae={class:"records-list"},oe=["onClick"],le={class:"record-info"},ne={class:"record-main"},ie={class:"cigarette-name"},de={key:0,class:"record-price"},re={class:"record-time"},ue={class:"record-type"},pe={key:0,class:"detail-popup"},ce={class:"popup-header"},ve={class:"detail-content"},me={class:"detail-item"},_e={class:"value"},fe={class:"detail-item"},ye={key:0,class:"detail-item"},we={class:"value"},ke={class:"detail-item"},De={class:"value"},xe={class:"detail-item"},ge={class:"value"},he={class:"date-picker-popup"},Re={class:"popup-header"},Ce={class:"date-picker-content"},Se=["max","min"],Te={class:"date-picker-actions"},Me=j({__name:"RecordsView",setup(be){const g=f([]),u=f("all"),o=f(v().format("YYYY-MM-DD")),p=f(!1),k=f(!1),i=f(null),H=new Date(2020,0,1),O=new Date(new Date().setHours(23,59,59,999)),h=[{text:"全部记录",value:"all"},{text:"抽烟",value:r.SMOKE},{text:"分烟",value:r.SHARE}],R=V(()=>{let s=[...g.value];if(u.value!=="all"&&(s=s.filter(e=>e.type===u.value)),o.value){const e=v(o.value);s=s.filter(l=>v(l.timestamp).isSame(e,"day"))}return s.sort((e, l)=>l.timestamp-e.timestamp)}),A=V(()=>{if(u.value==="all"&&!o.value)return"暂无记录";let s="";if(u.value!=="all"){const e=h.find(l=>l.value===u.value)?.text||"";s+=e}if(o.value){const e=v(o.value).format("YYYY年MM月DD日");s?s+=`的${e}`:s=e}return`暂无${s}记录`}),C= s=>{switch(s){case r.SMOKE:return"type-smoke";case r.SHARE:return"type-share";default:return""}},N= s=>{switch(s){case r.SMOKE:return"smoke";case r.SHARE:return"share";default:return"question"}},S= s=>{switch(s){case r.SMOKE:return"抽烟";case r.SHARE:return"分烟";default:return"未知"}},B= s=>{const e=v(),l=v(s),c=e.diff(l,"minute");return c<1?"刚刚":c<60?`${c}分钟前`:c<1440?`${Math.floor(c/60)}小时前`:l.format("MM-DD HH:mm")},T= s=>v(s).format("YYYY-MM-DD HH:mm:ss"),U= s=>{i.value=s,k.value=!0},z=()=>{o.value="",p.value=!1},F=async()=>{try{g.value=await J.getAll(Q)}catch(s){console.error("加载记录失败:",s)}};return q(async()=>{await F()}),(s, e)=>{const l=m("van-dropdown-item"),c=m("van-dropdown-menu"),I=m("van-field"),K=m("van-empty"),x=m("van-icon"),M=m("van-popup"),b=m("van-button");return _(),y("div",ee,[t("div",te,[e[10]||(e[10]=t("div",{class:"page-title"},"记录查询",-1)),t("div",se,[n(c,null,{default:w(()=>[n(l,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]= a=>u.value=a),options:h},null,8,["modelValue"])]),_:1}),n(I,{modelValue:o.value,"onUpdate:modelValue":e[1]||(e[1]= a=>o.value=a),readonly:"",clickable:"",name:"date",placeholder:"选择日期",onClick:e[2]||(e[2]= a=>p.value=!0),class:"date-field"},null,8,["modelValue"])])]),t("div",ae,[R.value.length===0?(_(),P(K,{key:0,description:A.value,image:"search"},null,8,["description"])):D("",!0),(_(!0),y(L,null,G(R.value, a=>(_(),y("div",{key:a.id,class:"record-item",onClick: Ve=>U(a)},[t("div",{class:Y(["record-icon",C(a.type)])},[n(x,{name:N(a.type)},null,8,["name"])],2),t("div",le,[t("div",ne,[t("span",ie,d(a.cigaretteName),1),a.price?(_(),y("span",de," ¥"+d(a.price.toFixed(2)),1)):D("",!0)]),t("div",re,d(B(a.timestamp)),1)]),t("div",ue,d(S(a.type)),1)],8,oe))),128))]),n(M,{show:k.value,"onUpdate:show":e[4]||(e[4]= a=>k.value=a),position:"bottom",round:"",style:{height:"40%"}},{default:w(()=>[i.value?(_(),y("div",pe,[t("div",ce,[e[11]||(e[11]=t("div",{class:"popup-title"},"记录详情",-1)),n(x,{name:"cross",onClick:e[3]||(e[3]= a=>k.value=!1)})]),t("div",ve,[t("div",me,[e[12]||(e[12]=t("span",{class:"label"},"香烟品牌:",-1)),t("span",_e,d(i.value.cigaretteName),1)]),t("div",fe,[e[13]||(e[13]=t("span",{class:"label"},"记录类型:",-1)),t("span",{class:Y(["value",C(i.value.type)])},d(S(i.value.type)),3)]),i.value.price?(_(),y("div",ye,[e[14]||(e[14]=t("span",{class:"label"},"价格:",-1)),t("span",we,"¥"+d(i.value.price.toFixed(2)),1)])):D("",!0),t("div",ke,[e[15]||(e[15]=t("span",{class:"label"},"记录时间:",-1)),t("span",De,d(T(i.value.timestamp)),1)]),t("div",xe,[e[16]||(e[16]=t("span",{class:"label"},"创建时间:",-1)),t("span",ge,d(T(i.value.createdAt)),1)])])])):D("",!0)]),_:1},8,["show"]),n(M,{show:p.value,"onUpdate:show":e[9]||(e[9]= a=>p.value=a),position:"bottom",round:"",style:{height:"50%"}},{default:w(()=>[t("div",he,[t("div",Re,[e[17]||(e[17]=t("div",{class:"popup-title"},"选择日期",-1)),n(x,{name:"cross",onClick:e[5]||(e[5]= a=>p.value=!1)})]),t("div",Ce,[W(t("input",{"onUpdate:modelValue":e[6]||(e[6]= a=>o.value=a),type:"date",class:"mobile-date-input",max:E(O).toISOString().split("T")[0],min:E(H).toISOString().split("T")[0],onChange:e[7]||(e[7]= a=>p.value=!1)},null,40,Se),[[X,o.value]]),t("div",Te,[n(b,{type:"default",size:"small",onClick:z},{default:w(()=>[...e[18]||(e[18]=[$(" 清除 ",-1)])]),_:1}),n(b,{type:"primary",size:"small",onClick:e[8]||(e[8]= a=>p.value=!1)},{default:w(()=>[...e[19]||(e[19]=[$(" 确定 ",-1)])]),_:1})])])])]),_:1},8,["show"])])}}}),Ee=Z(Me,[["__scopeId","data-v-497a6ad5"]]);export{Ee as default};
