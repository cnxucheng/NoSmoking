import{d as q,r as m,o as F,c as h,a as s,b as n,w as l,e as i,f as I,g as M,F as $,h as j,i as f,S as k,s as v,j as y,t as r,k as V,l as w,m as H,_ as O}from"./index-DZXCX67w.js";const P={class:"cigarettes"},R={class:"page-header"},G={class:"cigarette-list"},L={class:"cigarette-info"},J={class:"cigarette-name"},K={class:"cigarette-details"},Q={class:"price"},W={class:"pack-size"},X={class:"cigarette-date"},Z={class:"cigarette-actions"},ee={class:"popup-content"},ae={class:"popup-header"},te={class:"popup-title"},se={style:{margin:"16px"}},oe=q({__name:"CigarettesView",setup(ne){const d=m([]),c=m(!1),u=m(!1),p=m(null),o=m({name:"",price:0,packSize:20}),b=a=>a>0,A=a=>a>0,x=a=>V(a).format("YYYY-MM-DD HH:mm"),C=async()=>{try{d.value=await f.getAll(k),d.value.sort((a,e)=>e.createdAt-a.createdAt)}catch(a){console.error("加载香烟列表失败:",a),v("加载失败")}},D=a=>{u.value=!0,p.value=a.id,o.value={name:a.name,price:a.price,packSize:a.packSize},c.value=!0},E=async a=>{try{await H({title:"确认删除",message:"确定要删除这条香烟记录吗？"}),await f.delete(k,a),v("删除成功"),await C()}catch{console.log("取消删除")}},T=async()=>{try{const a=V().valueOf();if(u.value&&p.value){const e={id:p.value,name:o.value.name,price:o.value.price,packSize:o.value.packSize,createdAt:d.value.find(_=>_.id===p.value).createdAt,updatedAt:a};await f.update(k,e),v("更新成功")}else{const e={name:o.value.name,price:o.value.price,packSize:o.value.packSize,createdAt:a,updatedAt:a};await f.add(k,e),v("添加成功")}z(),await C()}catch(a){console.error("操作失败:",a),v("操作失败")}},z=()=>{c.value=!1,u.value=!1,p.value=null,o.value={name:"",price:0,packSize:20}};return F(async()=>{await C()}),(a,e)=>{const _=i("van-icon"),g=i("van-button"),B=i("van-empty"),S=i("van-field"),N=i("van-form"),U=i("van-popup");return w(),h("div",P,[s("div",R,[n(g,{type:"primary",size:"small",onClick:e[0]||(e[0]=t=>c.value=!0)},{default:l(()=>[n(_,{name:"add"}),e[5]||(e[5]=y(" 添加香烟 ",-1))]),_:1})]),s("div",G,[d.value.length===0?(w(),I(B,{key:0,description:"暂无香烟数据",image:"search"})):M("",!0),(w(!0),h($,null,j(d.value,t=>(w(),h("div",{key:t.id,class:"cigarette-item"},[s("div",L,[s("div",J,r(t.name),1),s("div",K,[s("span",Q,"¥"+r(t.price),1),s("span",W,r(t.packSize)+"支/包",1)]),s("div",X," 添加时间: "+r(x(t.createdAt)),1)]),s("div",Z,[n(g,{size:"small",type:"primary",onClick:Y=>D(t)},{default:l(()=>[...e[6]||(e[6]=[y(" 编辑 ",-1)])]),_:1},8,["onClick"]),n(g,{size:"small",type:"danger",onClick:Y=>E(t.id)},{default:l(()=>[...e[7]||(e[7]=[y(" 删除 ",-1)])]),_:1},8,["onClick"])])]))),128))]),n(U,{show:c.value,"onUpdate:show":e[4]||(e[4]=t=>c.value=t),position:"bottom",round:"",style:{height:"50%"}},{default:l(()=>[s("div",ee,[s("div",ae,[s("div",te,r(u.value?"编辑香烟":"添加香烟"),1),n(_,{name:"cross",onClick:z})]),n(N,{onSubmit:T,class:"cigarette-form"},{default:l(()=>[n(S,{modelValue:o.value.name,"onUpdate:modelValue":e[1]||(e[1]=t=>o.value.name=t),name:"name",label:"香烟名称",placeholder:"请输入香烟名称",rules:[{required:!0,message:"请输入香烟名称"}]},null,8,["modelValue"]),n(S,{modelValue:o.value.price,"onUpdate:modelValue":e[2]||(e[2]=t=>o.value.price=t),name:"price",label:"价格",placeholder:"请输入价格",type:"number",rules:[{required:!0,message:"请输入价格"},{validator:b,message:"价格必须大于0"}]},{"right-icon":l(()=>[...e[8]||(e[8]=[s("span",null,"元",-1)])]),_:1},8,["modelValue","rules"]),n(S,{modelValue:o.value.packSize,"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.packSize=t),name:"packSize",label:"一包数量",placeholder:"请输入一包的数量",type:"number",rules:[{required:!0,message:"请输入一包的数量"},{validator:A,message:"数量必须大于0"}]},{"right-icon":l(()=>[...e[9]||(e[9]=[s("span",null,"支",-1)])]),_:1},8,["modelValue","rules"]),s("div",se,[n(g,{round:"",block:"",type:"primary","native-type":"submit"},{default:l(()=>[y(r(u.value?"更新":"添加"),1)]),_:1})])]),_:1})])]),_:1},8,["show"])])}}}),ie=O(oe,[["__scopeId","data-v-d56c03ec"]]);export{ie as default};
