import{d as S,r as D,x as f,R as p,q as m,o as C,b as h,f as s,t as n,F as T,k as R,l as k,y as P,D as F,z as E,v as y,_ as Q}from"./index-CeUphd_L.js";const z={class:"stats"},O={class:"stats-overview"},B={class:"overview-card"},V={class:"overview-item"},Y={class:"overview-value"},$={class:"overview-item"},K={class:"overview-value"},q={class:"overview-item"},j={class:"overview-value"},A={class:"charts-section"},I={class:"chart-card"},L={class:"chart-container"},N={class:"bar-chart"},W={class:"bar-label"},G={class:"bar-wrapper"},H={class:"bar-value"},J={class:"detail-stats"},U={class:"stats-list"},X={class:"stat-item"},Z={class:"stat-value"},ss={class:"stat-item"},ts={class:"stat-value"},as={class:"stat-item"},es={class:"stat-value"},os={class:"stat-item"},is={class:"stat-value"},rs=S({__name:"StatsView",setup(ls){const c=D([]),d=f(()=>{const t=c.value.filter(r=>r.type===p.SMOKE).length,e=c.value.reduce((r,_)=>r+(_.price||0),0),l=new Set(c.value.map(r=>m(r.timestamp).format("YYYY-MM-DD"))).size,v=t/Math.max(l,1),o=x(c.value),u=e/Math.max(l,1),i=t>0?e/t:0;return{totalCount:t,totalCost:e,avgPerDay:v,maxQuitTime:o,recordDays:l,avgCostPerDay:u,avgPricePerCigarette:i}}),g=f(()=>{const a=c.value.filter(o=>o.type===p.SMOKE),t=7,e=[],l={Monday:"一",Tuesday:"二",Wednesday:"三",Thursday:"四",Friday:"五",Saturday:"六",Sunday:"日"};for(let o=t-1;o>=0;o--){const u=m().subtract(o,"day"),i=l[u.format("dddd")];console.log(i);const r=a.filter(_=>m(_.timestamp).isSame(u,"day"));e.push({label:i,value:r.length})}const v=Math.max(...e.map(o=>o.value),1);return e.map(o=>({...o,percentage:o.value/v*80}))}),b=a=>a===0?"bar-zero":a<=3?"bar-low":a<=6?"bar-medium":"bar-high",w=a=>a<60?`${a}分钟`:a<1440?`${Math.floor(a/60)}小时`:`${Math.floor(a/1440)}天`,x=a=>{const t=a.filter(i=>i.type===p.SMOKE).sort((i,r)=>i.timestamp-r.timestamp);let e=0;for(let i=1;i<t.length;i++){const r=t[i].timestamp-t[i-1].timestamp;e=Math.max(e,r)}const l=m(),v=t.length>0?t[t.length-1].timestamp:0,o=v>0?l.diff(v):0,u=Math.max(e,o);return Math.floor(u/(1e3*60))},M=async()=>{try{c.value=await k.getAll(P)}catch(a){console.error("加载记录失败:",a)}};return C(async()=>{await M()}),(a,t)=>(y(),h("div",z,[t[9]||(t[9]=s("div",{class:"page-header"},[s("div",{class:"page-title"},"数据统计")],-1)),s("div",O,[s("div",B,[s("div",V,[s("div",Y,n(d.value.totalCount),1),t[0]||(t[0]=s("div",{class:"overview-label"},"总抽烟数",-1))]),s("div",$,[s("div",K,"¥"+n(d.value.totalCost.toFixed(2)),1),t[1]||(t[1]=s("div",{class:"overview-label"},"总花费",-1))]),s("div",q,[s("div",j,n(d.value.avgPerDay.toFixed(1)),1),t[2]||(t[2]=s("div",{class:"overview-label"},"日均抽烟",-1))])])]),s("div",A,[s("div",I,[t[3]||(t[3]=s("div",{class:"chart-title"},"本周抽烟趋势",-1)),s("div",L,[s("div",N,[(y(!0),h(T,null,R(g.value,(e,l)=>(y(),h("div",{key:l,class:"bar-item"},[s("div",W,n(e.label),1),s("div",G,[s("div",{class:E(["bar",b(e.value)]),style:F({height:`${e.percentage}%`})},null,6)]),s("div",H,n(e.value),1)]))),128))])])])]),s("div",J,[t[8]||(t[8]=s("div",{class:"section-title"},"详细统计",-1)),s("div",U,[s("div",X,[t[4]||(t[4]=s("span",{class:"stat-name"},"最长戒烟时间",-1)),s("span",Z,n(w(d.value.maxQuitTime)),1)]),s("div",ss,[t[5]||(t[5]=s("span",{class:"stat-name"},"记录天数",-1)),s("span",ts,n(d.value.recordDays)+"天",1)]),s("div",as,[t[6]||(t[6]=s("span",{class:"stat-name"},"日均花费",-1)),s("span",es,"¥"+n(d.value.avgCostPerDay.toFixed(2)),1)]),s("div",os,[t[7]||(t[7]=s("span",{class:"stat-name"},"单根烟平均价格",-1)),s("span",is,"¥"+n(d.value.avgPricePerCigarette.toFixed(2)),1)])])])]))}}),ds=Q(rs,[["__scopeId","data-v-245f5663"]]);export{ds as default};
