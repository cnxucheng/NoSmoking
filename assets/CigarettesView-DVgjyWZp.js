import{e as V,i as F,m as Y,u as H,c as n,a as M,s as $,d as j,r as v,o as L,b,f as s,w as c,g as u,h as R,j as W,F as G,k as J,l as k,S as y,n as _,p as w,t as d,q as A,v as C,_ as K}from"./index-CeUphd_L.js";let z;const Q={title:"",width:"",theme:null,message:"",overlay:!0,callback:null,teleport:"body",className:"",allowHtml:!1,lockScroll:!0,transition:void 0,beforeClose:null,overlayClass:"",overlayStyle:void 0,messageAlign:"",cancelButtonText:"",cancelButtonColor:null,cancelButtonDisabled:!1,confirmButtonText:"",confirmButtonColor:null,confirmButtonDisabled:!1,showConfirmButton:!0,showCancelButton:!1,closeOnPopstate:!0,closeOnClickOverlay:!1};let X=V({},Q);function Z(){({instance:z}=Y({setup(){const{state:l,toggle:i}=H();return()=>n($,M(l,{"onUpdate:show":i}),null)}}))}function ee(p){return F?new Promise((l,i)=>{z||Z(),z.open(V({},X,p,{callback:r=>{(r==="confirm"?l:i)(r)}}))}):Promise.resolve()}const te=p=>ee(V({showCancelButton:!0},p)),ae={class:"cigarettes"},se={class:"page-header"},oe={class:"cigarette-list"},ne={class:"cigarette-info"},le={class:"cigarette-name"},ie={class:"cigarette-details"},re={class:"price"},ce={class:"pack-size"},ue={class:"cigarette-date"},de={class:"cigarette-actions"},pe={class:"popup-content"},me={class:"popup-header"},ve={class:"popup-title"},_e={style:{margin:"16px"}},fe=j({__name:"CigarettesView",setup(p){const l=v([]),i=v(!1),r=v(!1),m=v(null),o=v({name:"",price:0,packSize:20}),x=t=>t>0,D=t=>t>0,T=t=>A(t).format("YYYY-MM-DD HH:mm"),h=async()=>{try{l.value=await k.getAll(y),l.value.sort((t,e)=>e.createdAt-t.createdAt)}catch(t){console.error("加载香烟列表失败:",t),_("加载失败")}},O=t=>{r.value=!0,m.value=t.id,o.value={name:t.name,price:t.price,packSize:t.packSize},i.value=!0},P=async t=>{try{await te({title:"确认删除",message:"确定要删除这条香烟记录吗？"}),await k.delete(y,t),_("删除成功"),await h()}catch{console.log("取消删除")}},E=async()=>{try{const t=A().valueOf();if(r.value&&m.value){const e={id:m.value,name:o.value.name,price:o.value.price,packSize:o.value.packSize,createdAt:l.value.find(f=>f.id===m.value).createdAt,updatedAt:t};await k.update(y,e),_("更新成功")}else{const e={name:o.value.name,price:o.value.price,packSize:o.value.packSize,createdAt:t,updatedAt:t};await k.add(y,e),_("添加成功")}B(),await h()}catch(t){console.error("操作失败:",t),_("操作失败")}},B=()=>{i.value=!1,r.value=!1,m.value=null,o.value={name:"",price:0,packSize:20}};return L(async()=>{await h()}),(t,e)=>{const f=u("van-icon"),g=u("van-button"),N=u("van-empty"),S=u("van-field"),U=u("van-form"),I=u("van-popup");return C(),b("div",ae,[s("div",se,[e[6]||(e[6]=s("div",{class:"page-title"},"香烟管理",-1)),n(g,{type:"primary",size:"small",onClick:e[0]||(e[0]=a=>i.value=!0)},{default:c(()=>[n(f,{name:"add"}),e[5]||(e[5]=w(" 添加香烟 ",-1))]),_:1})]),s("div",oe,[l.value.length===0?(C(),R(N,{key:0,description:"暂无香烟数据",image:"search"})):W("",!0),(C(!0),b(G,null,J(l.value,a=>(C(),b("div",{key:a.id,class:"cigarette-item"},[s("div",ne,[s("div",le,d(a.name),1),s("div",ie,[s("span",re,"¥"+d(a.price),1),s("span",ce,d(a.packSize)+"支/包",1)]),s("div",ue," 添加时间: "+d(T(a.createdAt)),1)]),s("div",de,[n(g,{size:"small",type:"primary",onClick:q=>O(a)},{default:c(()=>[...e[7]||(e[7]=[w(" 编辑 ",-1)])]),_:1},8,["onClick"]),n(g,{size:"small",type:"danger",onClick:q=>P(a.id)},{default:c(()=>[...e[8]||(e[8]=[w(" 删除 ",-1)])]),_:1},8,["onClick"])])]))),128))]),n(I,{show:i.value,"onUpdate:show":e[4]||(e[4]=a=>i.value=a),position:"bottom",round:"",style:{height:"50%"}},{default:c(()=>[s("div",pe,[s("div",me,[s("div",ve,d(r.value?"编辑香烟":"添加香烟"),1),n(f,{name:"cross",onClick:B})]),n(U,{onSubmit:E,class:"cigarette-form"},{default:c(()=>[n(S,{modelValue:o.value.name,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.name=a),name:"name",label:"香烟名称",placeholder:"请输入香烟名称",rules:[{required:!0,message:"请输入香烟名称"}]},null,8,["modelValue"]),n(S,{modelValue:o.value.price,"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.price=a),name:"price",label:"价格",placeholder:"请输入价格",type:"number",rules:[{required:!0,message:"请输入价格"},{validator:x,message:"价格必须大于0"}]},{"right-icon":c(()=>[...e[9]||(e[9]=[s("span",null,"元",-1)])]),_:1},8,["modelValue","rules"]),n(S,{modelValue:o.value.packSize,"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.packSize=a),name:"packSize",label:"一包数量",placeholder:"请输入一包的数量",type:"number",rules:[{required:!0,message:"请输入一包的数量"},{validator:D,message:"数量必须大于0"}]},{"right-icon":c(()=>[...e[10]||(e[10]=[s("span",null,"支",-1)])]),_:1},8,["modelValue","rules"]),s("div",_e,[n(g,{round:"",block:"",type:"primary","native-type":"submit"},{default:c(()=>[w(d(r.value?"更新":"添加"),1)]),_:1})])]),_:1})])]),_:1},8,["show"])])}}}),ke=K(fe,[["__scopeId","data-v-a67871cc"]]);export{ke as default};
