import{d as S,r as C,n as f,R as p,k as m,o as D,c as h,a as t,t as n,F as T,h as R,i as k,p as P,y as F,q as E,l as y,_ as Q}from"./index-DZXCX67w.js";const O={class:"stats"},z={class:"stats-overview"},B={class:"overview-card"},V={class:"overview-item"},Y={class:"overview-value"},$={class:"overview-item"},K={class:"overview-value"},q={class:"overview-item"},j={class:"overview-value"},A={class:"charts-section"},I={class:"chart-card"},L={class:"chart-container"},N={class:"bar-chart"},W={class:"bar-label"},G={class:"bar-wrapper"},H={class:"bar-value"},J={class:"detail-stats"},U={class:"stats-list"},X={class:"stat-item"},Z={class:"stat-value"},tt={class:"stat-item"},st={class:"stat-value"},at={class:"stat-item"},et={class:"stat-value"},ot={class:"stat-item"},it={class:"stat-value"},rt=S({__name:"StatsView",setup(lt){const d=C([]),c=f(()=>{const s=d.value.filter(r=>r.type===p.SMOKE).length,e=d.value.reduce((r,_)=>r+(_.price||0),0),l=new Set(d.value.map(r=>m(r.timestamp).format("YYYY-MM-DD"))).size,v=s/Math.max(l,1),o=x(d.value),u=e/Math.max(l,1),i=s>0?e/s:0;return{totalCount:s,totalCost:e,avgPerDay:v,maxQuitTime:o,recordDays:l,avgCostPerDay:u,avgPricePerCigarette:i}}),g=f(()=>{const a=d.value.filter(o=>o.type===p.SMOKE),s=7,e=[],l={Monday:"一",Tuesday:"二",Wednesday:"三",Thursday:"四",Friday:"五",Saturday:"六",Sunday:"日"};for(let o=s-1;o>=0;o--){const u=m().subtract(o,"day"),i=l[u.format("dddd")],r=a.filter(_=>m(_.timestamp).isSame(u,"day"));e.push({label:i,value:r.length})}const v=Math.max(...e.map(o=>o.value),1);return e.map(o=>({...o,percentage:o.value/v*80}))}),w=a=>a===0?"bar-zero":a<=3?"bar-low":a<=6?"bar-medium":"bar-high",b=a=>a<60?`${a}分钟`:a<1440?`${Math.floor(a/60)}小时`:`${Math.floor(a/1440)}天`,x=a=>{const s=a.filter(i=>i.type===p.SMOKE).sort((i,r)=>i.timestamp-r.timestamp);let e=0;for(let i=1;i<s.length;i++){const r=s[i].timestamp-s[i-1].timestamp;e=Math.max(e,r)}const l=m(),v=s.length>0?s[s.length-1].timestamp:0,o=v>0?l.diff(v):0,u=Math.max(e,o);return Math.floor(u/(1e3*60))},M=async()=>{try{d.value=await k.getAll(P)}catch(a){console.error("加载记录失败:",a)}};return D(async()=>{await M()}),(a,s)=>(y(),h("div",O,[t("div",z,[t("div",B,[t("div",V,[t("div",Y,n(c.value.totalCount),1),s[0]||(s[0]=t("div",{class:"overview-label"},"总抽烟数",-1))]),t("div",$,[t("div",K,"¥"+n(c.value.totalCost.toFixed(2)),1),s[1]||(s[1]=t("div",{class:"overview-label"},"总花费",-1))]),t("div",q,[t("div",j,n(c.value.avgPerDay.toFixed(1)),1),s[2]||(s[2]=t("div",{class:"overview-label"},"日均抽烟",-1))])])]),t("div",A,[t("div",I,[s[3]||(s[3]=t("div",{class:"chart-title"},"本周抽烟趋势",-1)),t("div",L,[t("div",N,[(y(!0),h(T,null,R(g.value,(e,l)=>(y(),h("div",{key:l,class:"bar-item"},[t("div",W,n(e.label),1),t("div",G,[t("div",{class:E(["bar",w(e.value)]),style:F({height:`${e.percentage}%`})},null,6)]),t("div",H,n(e.value),1)]))),128))])])])]),t("div",J,[s[8]||(s[8]=t("div",{class:"section-title"},"详细统计",-1)),t("div",U,[t("div",X,[s[4]||(s[4]=t("span",{class:"stat-name"},"最长戒烟时间",-1)),t("span",Z,n(b(c.value.maxQuitTime)),1)]),t("div",tt,[s[5]||(s[5]=t("span",{class:"stat-name"},"记录天数",-1)),t("span",st,n(c.value.recordDays)+"天",1)]),t("div",at,[s[6]||(s[6]=t("span",{class:"stat-name"},"日均花费",-1)),t("span",et,"¥"+n(c.value.avgCostPerDay.toFixed(2)),1)]),t("div",ot,[s[7]||(s[7]=t("span",{class:"stat-name"},"单根烟平均价格",-1)),t("span",it,"¥"+n(c.value.avgPricePerCigarette.toFixed(2)),1)])])])]))}}),ct=Q(rt,[["__scopeId","data-v-067a42cf"]]);export{ct as default};
